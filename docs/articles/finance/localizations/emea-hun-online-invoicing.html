<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Online invoicing system | WIKA Documentation </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Online invoicing system | WIKA Documentation ">
    <meta name="generator" content="docfx 2.56.6.0">
    
    <link rel="shortcut icon" href="../../../microsoft-dynamics-crm-365-icon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../TOC.html">
    
    <meta property="docfx:rel" content="../../../">
    
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="online-invoicing-system">Online invoicing system</h1>


<p>The National Tax and Customs Administration of Hungary has announced that, starting July 1, 2018, companies in Hungary are required to supply data of their issued invoices to the Real-time invoice reporting (RTIR) platform of the Online invoicing system.</p>
<p>For more information, see <a href="https://onlineszamla.nav.gov.hu">https://onlineszamla.nav.gov.hu</a>.</p>
<p>This topic describes how to set up Electronic reporting (ER) configurations, and how to set up and use electronic messaging (EM) functionality for RTIR.</p>
<p>The topic includes information about how to complete the following tasks:</p>
<ul>
<li>Import ER configurations, and set up application-specific parameters.</li>
<li>Set up EM functionality.</li>
<li>Work with EM functionality for RTIR.</li>
</ul>
<h2 id="import-er-configurations">Import ER configurations</h2>
<p>To prepare your Microsoft Dynamics 365 Finance application for RTIR, you must import the following ER configurations.</p>
<table>
<thead>
<tr>
<th><strong>Number</strong></th>
<th><strong>Configuration name</strong></th>
<th><strong>Configuration type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Invoices Communication Model</td>
<td>Model</td>
<td>The model that represents data for reporting incoming and outgoing invoices.</td>
</tr>
<tr>
<td>2</td>
<td>RTIR mapping</td>
<td>Model mapping (export)</td>
<td>The model mapping configuration that collects data from Finance in accordance with Hungarian RTIR requirements.</td>
</tr>
<tr>
<td>3</td>
<td>RTIR Invoice Data (HU)</td>
<td>Format XML (export)</td>
<td>The format for exporting RTIR invoice data.</td>
</tr>
<tr>
<td>4</td>
<td>RTIR Token Exchange Request (HU)</td>
<td>Format XML (export)</td>
<td>The format for exporting RTIR token exchange requests.</td>
</tr>
<tr>
<td>5</td>
<td>RTIR Manage Invoice Request (HU)</td>
<td>Format XML (export)</td>
<td>The format for exporting RTIR manage invoice requests.</td>
</tr>
<tr>
<td>6</td>
<td>RTIR Query Invoice Status Request (HU)</td>
<td>Format XML (export)</td>
<td>The format for exporting RTIR query invoice status requests.</td>
</tr>
<tr>
<td>7</td>
<td>Electronic Messages framework model</td>
<td>Model</td>
<td>The model for the EM framework.</td>
</tr>
<tr>
<td>8</td>
<td>RTIR import model mapping</td>
<td>Model mapping (import)</td>
<td>The importing model mapping configuration that provides updates of EM data during RTIR.</td>
</tr>
<tr>
<td>9</td>
<td>RTIR import format (HU)</td>
<td>Format XML (import)</td>
<td>The importing format configuration that parses responses from RTIR in the data structure of the EM framework.</td>
</tr>
</tbody>
</table>
<div class="IMPORTANT">
<h5>Important</h5>
<p>Be sure to import the most recent versions of these configurations. The version description usually includes the number of the Microsoft Knowledge Base (KB) article that explains the changes that were introduced in the configuration version.</p>
</div>
<div class="NOTE">
<h5>Note</h5>
<p>After all the ER configurations from the preceding table are imported, set the <strong>Default for model mapping</strong> option to <strong>Yes</strong> for the <strong>RTIR mapping</strong> and <strong>RTIR import model mapping</strong> configurations.</p>
</div>
<p>For more information about how to download ER configurations from Microsoft Dynamics Lifecycle Services (LCS), see <a href="../../fin-ops-core/dev-itpro/analytics/download-electronic-reporting-configuration-lcs.html">Download Electronic reporting configurations from Lifecycle Services</a>.</p>
<h2 id="set-up-application-specific-parameters">Set up application-specific parameters</h2>
<p>The format that is used to report invoice data to the Hungarian Online Invoicing System requires specific values from enumerated lists for some elements (for example, units of measure or line expression indicators). For these elements, before you start to use RTIR, you must set up application-specific parameters that the <strong>RTIR Invoice Data (HU)</strong> format will use.</p>
<h3 id="line-expression-indicator">Line expression indicator</h3>
<p>The <strong>lineExpressionIndicator</strong> element of the Boolean type must be reported to the Online invoicing system for invoice lines. For natural units of measure, a value of <strong>true</strong> must be reported for the <strong>lineExpressionIndicator</strong> element. If the unit of measure isn't indicated for an invoice line, a value of <strong>false</strong> must be reported for the <strong>lineExpressionIndicator</strong> element.</p>
<ol>
<li><p>In the <strong>Electronic reporting</strong> workspace, select the most recent imported version of the <strong>RTIR Invoice Data (HU)</strong> format.</p>
</li>
<li><p>On the Action Pane, on the <strong>Configurations</strong> tab, in the <strong>Application specific parameters</strong> group, select <strong>Setup</strong>.</p>
</li>
<li><p>On the <strong>Lookups</strong> FastTab, select <strong>UnitOfMeasureTypeLookup</strong> for the most recent version of the format, and then define which units of measure must be reported as natural (that is, a value of <strong>true</strong> must be reported for the <strong>lineExpressionIndicator</strong> element in the Online invoicing system).</p>
</li>
<li><p>Match all the units in your Legal entity. For example, for kilometers, add the following line:</p>
<ul>
<li><strong>Lookup result:</strong> Natural</li>
<li><strong>Line:</strong> 1</li>
<li><strong>Unit of measure code:</strong> km
This value is the value from the <strong>Units</strong> page for your legal entity (<strong>Organization administration</strong> &gt; <strong>Setup</strong> &gt; <strong>Units</strong>).</li>
</ul>
</li>
</ol>
<div class="IMPORTANT">
<h5>Important</h5>
<p>At the end of the list, add the following two lines.</p>
<table>
<thead>
<tr>
<th><strong>Lookup result</strong></th>
<th><strong>Line</strong></th>
<th><strong>Unit of measure</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>NONE</td>
<td>This line must be next to last in the list</td>
<td>*Blank*</td>
</tr>
<tr>
<td>Other</td>
<td>This line must be last in the list.</td>
<td>*Not blank*</td>
</tr>
</tbody>
</table>
</div>
<p>The <strong>lineDescription</strong> element must be reported when the <strong>lineExpressionIndicator</strong> element is reported. If there is no value for the
<strong>lineDescription</strong> element on the related line of the invoice, this element will indicate the voucher of the related invoice. We recommend that you define the description on all invoices lines of all types, except invoices that are posted from a sales order. In that case, the <strong>lineDescription</strong> element will report the item.</p>
<h3 id="unit-of-measure">Unit of measure</h3>
<p>For the <strong>unitOfMeasure</strong> element, one of the values from the enumerated list that is defined by the XSD schema of the <strong>Invoice Data</strong> format must be reported.</p>
<ol>
<li><p>In the <strong>Electronic reporting</strong> workspace, select the most recent imported version of the <strong>RTIR Invoice Data (HU)</strong> format.</p>
</li>
<li><p>On the Action Pane, on the <strong>Configurations</strong> tab, in the <strong>Application specific parameters</strong> group, select <strong>Setup</strong>.</p>
</li>
<li><p>On the <strong>Lookups</strong> FastTab, select <strong>UnitOfMeasureLookup</strong> for the most recent version of the format, and then define the correspondence between the reference units of measure and the enumerated list of the Online invoicing system. For example, for kilometers, add the following line:</p>
<ul>
<li><strong>Lookup result:</strong> KILOMETER</li>
<li><strong>Line:</strong> 1</li>
<li><strong>Unit of measure code:</strong> km
(This value is the value from the <strong>Units</strong> page for your legal entity.)</li>
</ul>
</li>
</ol>
<p>Match all the units in your legal entity that you can find a related value for in the enumerated list.</p>
<table>
<thead>
<tr>
<th><strong>UnitOfMeasureType</strong></th>
<th><strong>Description (hu)</strong></th>
<th><strong>Description (en-us)</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>PIECE</td>
<td>Darab</td>
<td>Piece</td>
</tr>
<tr>
<td>KILOGRAM</td>
<td>Kilogramm</td>
<td>Kilogram</td>
</tr>
<tr>
<td>TON</td>
<td>Metrikus tonna</td>
<td>Metric ton</td>
</tr>
<tr>
<td>KWH</td>
<td>Kilowatt óra</td>
<td>Kilowatt hour</td>
</tr>
<tr>
<td>DAY</td>
<td>Nap</td>
<td>Day</td>
</tr>
<tr>
<td>HOUR</td>
<td>Óra</td>
<td>Hour</td>
</tr>
<tr>
<td>MINUTE</td>
<td>Perc</td>
<td>Minute</td>
</tr>
<tr>
<td>MONTH</td>
<td>Hónap</td>
<td>Month</td>
</tr>
<tr>
<td>LITER</td>
<td>Liter</td>
<td>Liter</td>
</tr>
<tr>
<td>KILOMETER</td>
<td>Kilométer</td>
<td>Kilometer</td>
</tr>
<tr>
<td>CUBIC_METER</td>
<td>Köbméter</td>
<td>Cubic meter</td>
</tr>
<tr>
<td>METER</td>
<td>Méter</td>
<td>Meter</td>
</tr>
<tr>
<td>LINEAR_METER</td>
<td>Folyóméter</td>
<td>Linear meter</td>
</tr>
<tr>
<td>CARTON</td>
<td>Karton</td>
<td>Carton</td>
</tr>
<tr>
<td>PACK</td>
<td>Csomag</td>
<td>Pack</td>
</tr>
<tr>
<td>OWN</td>
<td>Saját mennyiségi egység megnevezés</td>
<td>Own unit of measure</td>
</tr>
</tbody>
</table>
<div class="IMPORTANT">
<h5>Important</h5>
<p>Instead of adding all the <strong>own</strong> values to the list you can define <strong>*Not blank*</strong> for the <strong>OWN</strong> lookup result. All the other values will then be reported as <strong>OWN</strong>. The <strong>OWN</strong> lookup result must be added, and it must be last in the list.</p>
</div>
<p>The <strong>unitOfMeasureOwn</strong> element must report information about any unit of measure that there is no value for in the enumerated list of the <strong>unitOfMeasure</strong> element. This element must be reported when the <strong>unitOfMeasure</strong> element has a value of <strong>OWN</strong>.</p>
<p>You can export the setup of application-specific parameters from one version of the report and import it into another version. You can also export the setup from one report and import it into another report, provided that both reports have the same structure of lookup fields.</p>
<p>When you've finished setting up conditions, change the value of the <strong>State</strong> field to <strong>Completed</strong>, save your changes, and close the page.</p>
<h2 id="import-a-package-of-data-entities-that-includes-a-predefined-em-setup">Import a package of data entities that includes a predefined EM setup</h2>
<p>EM functionality is provided to maintain different electronic reporting processes for different document types. For more information about electronic messages, see <a href="https://github.com/MicrosoftDocs/Dynamics-365-Operations/blob/HU-RTIR/articles/finance/general-ledger/electronic-messaging.md">Electronic messaging</a>.</p>
<p>The process of setting up the EM functionality for RTIR has many steps. Because the names of some predefined entities are used in the ER configurations, it's important that you use a set of predefined values that are delivered in a package of data entities for the related tables.</p>
<ol>
<li><p>In <a href="https://lcs.dynamics.com/v2">LCS</a>, go to the Shared asset library, and select the <strong>Data package</strong> asset type.</p>
</li>
<li><p>In the list of data package files, find <strong>HU RTIR setup.zip</strong>, and download it to your computer. There might be several versions of the package. Be sure to download the most recent version.</p>
</li>
<li><p>After the HU RTIR setup.zip file is downloaded, open Finance, select the company that you will interoperate with the Hungarian Online invoicing system from, and then go to <strong>Workspaces</strong> &gt; <strong>Data management</strong>.</p>
</li>
<li><p>In the <strong>Data management</strong> workspace, go to <strong>Framework parameters</strong> &gt; <strong>Entity settings</strong>, and then select <strong>Refresh entity list</strong>. Wait for confirmation that the refresh has been completed. For more information about how to refresh the entity list, see <a href="https://docs.microsoft.com/dynamics365/dev-itpro/data-entities/data-entities#entity-list-refresh">Entity list refresh</a>.</p>
</li>
<li><p>Validate that the source data and target data are correctly mapped. For more information, see the section about validation in <a href="https://docs.microsoft.com/dynamics365/dev-itpro/data-entities/data-import-export-job#validate-that-the-source-data-and-target-data-are-mapped-correctly">Data import and export jobs</a>.</p>
</li>
<li><p>Before the data entities are used for the first time to import the data from the package, sync the mapping of source data and target data. In the list for the package, select a data entity, and then, on the Action Pane, select<strong>Modify target mapping</strong>.</p>
</li>
<li><p>Above the grid for the package, select <strong>Generate mapping</strong> to create a mapping from scratch, and then save the mapping.</p>
</li>
<li><p>Repeat steps 6 through 7 for each data entity in the package before you start the import.</p>
<p>For more information about data management, see <a href="https://docs.microsoft.com/dynamics365/dev-itpro/data-entities/data-entities-data-packages">Data management</a>.</p>
</li>
<li><p>You must now import data from the HU RTIR setup.zip file into the selected company. In the <strong>Data management</strong> workspace, select <strong>Import</strong>.</p>
</li>
<li><p>Select <strong>Upload and add</strong>, select the <strong>HU RTIR setup.zip</strong> file on your computer, and upload it.</p>
</li>
<li><p>After the data entities are uploaded, on the Action Pane, select <strong>Import</strong>.</p>
</li>
</ol>
<p><img src="media/1_Setup_EM.png" alt="Data management workspace"></p>
<p>You will receive a notification in <strong>Messages</strong>, or you can manually refresh the page to view the data import progress. When the import process is completed, the <strong>Execution summary</strong> page shows the results.</p>
<p>The HU RTIR setup.zip package provides the setup for <strong>Online invoicing</strong> processing in the EM functionality that supports interoperation with the Hungarian Online invoicing system. The following illustration shows the schema for <strong>Online invoicing</strong> processing.</p>
<p><img src="media/2_Scema.png" alt="Online invoicing processing diagram"></p>
<p>The following table describes the processing actions of <strong>Online invoicing</strong> processing.</p>
<table>
<thead>
<tr>
<th><strong>Action</strong></th>
<th><strong>Type</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Create EM items</td>
<td>Message item execution level</td>
<td>This action runs the <strong>EMCreateItemsController_HU</strong> executable class to generate electronic message items for issued invoices that were posted. Additional setup of the <strong>EMCreateItemsController_HU</strong> executable class parameters is required.</td>
</tr>
<tr>
<td>Evaluate EM items</td>
<td>Message item execution level</td>
<td>This action runs the <strong>EMAdditionalFieldsEvaluationController_HU</strong> executable class to calculate additional field values for electronic message items. These values include the invoice operation, the reference to the original invoice, and the last line number.</td>
</tr>
<tr>
<td>Generate EM</td>
<td>Electronic reporting export</td>
<td>This action runs the <strong>RTIR Invoice Data (HU)</strong> format to create a package of invoices that can be submitted to the Online invoicing system.</td>
</tr>
<tr>
<td>Generate token request</td>
<td>Electronic reporting export message</td>
<td>This action runs the <strong>RTIR Token Exchange Request (HU)</strong> format to create the exchange token file in XML format.</td>
</tr>
<tr>
<td>Submit token request</td>
<td>Web service</td>
<td>This action submits the token file in XML format to the <strong>Token exchange</strong> web service.</td>
</tr>
<tr>
<td>Import token response</td>
<td>Electronic reporting import</td>
<td>This action imports the response from the Online invoicing system and stores the token that is received in the <strong>Message additional fields</strong> FastTab by using the <strong>RTIR import format (HU)</strong> configuration.</td>
</tr>
<tr>
<td>Generate invoice request</td>
<td>Electronic reporting export message</td>
<td>This action runs the <strong>RTIR Manage Invoice Request (HU)</strong> format to create the <strong>ManageInvoiceRequest.xml</strong> file by encoding invoices, inserting a token in the request, and so on.</td>
</tr>
<tr>
<td>Submit invoice request</td>
<td>Web service</td>
<td>This action submits the <strong>ManageInvoiceRequest.xml</strong> file to the <strong>Manage invoice</strong> web service.</td>
</tr>
<tr>
<td>Import invoice response</td>
<td>Electronic reporting import</td>
<td>This action imports the response from the Online invoicing system and stores the transaction ID that is received in the <strong>Message additional fields</strong> FastTab by using the <strong>RTIR import format (HU)</strong> configuration.</td>
</tr>
<tr>
<td>Generate status request</td>
<td>Electronic reporting export message</td>
<td>This action runs the <strong>RTIR Query Invoice Status Request (HU)</strong> format to create the <strong>QueryInvoiceStatusRequest.xml</strong> file.</td>
</tr>
<tr>
<td>Submit status request</td>
<td>Web service</td>
<td>This action submits the <strong>QueryInvoiceStatusRequest.xml</strong> file to the <strong>Query invoice status</strong> web service.</td>
</tr>
<tr>
<td>Import status response</td>
<td>Electronic reporting import</td>
<td>This action imports the response from the Online invoicing system. If the status of the EM item is <strong>Received</strong> (which indicates that the invoice was received by the Online invoicing system) or <strong>Processing</strong> (which indicates that the invoice is being processed in the Online invoicing system), the system will send the status request again, until the status of the EM item is updated to <strong>Processed</strong>.</td>
</tr>
<tr>
<td>Exclude EM items</td>
<td>User processing</td>
<td>This manual user action resets the status of the EM item from <strong>Evaluated</strong> to <strong>Excluded</strong> and excludes the item from processing.</td>
</tr>
<tr>
<td>Include EM items in processing</td>
<td>User processing</td>
<td>This manual user action resets the status of the EM item from <strong>Excluded</strong> or <strong>Manual editing</strong> to <strong>Evaluated</strong>.</td>
</tr>
<tr>
<td>Reset EM item status</td>
<td>User processing</td>
<td>This manual user action resets the status of the EM item from <strong>Rejected</strong> to <strong>Created</strong>.</td>
</tr>
<tr>
<td>Reset EM status</td>
<td>Message level user processing</td>
<td>This manual user action resets the status of the electronic message from <strong>Error invoice response importing</strong>, <strong>Error sending invoice request</strong>, or <strong>Error Token response importing</strong> to <strong>Generated</strong> so that processing for the electronic message can continue.</td>
</tr>
</tbody>
</table>
<p>For more information about the predefined setup that is included in the data entities in the package for RTIR, see <a href="https://github.com/MicrosoftDocs/Dynamics-365-Operations/blob/HU-RTIR/articles/finance/localizations/emea-hun-online-invoicing.md#appendix-1-electronic-message-setup-for-rtir">Appendix 1: Electronic messages setup for RTIR</a> later in this topic.</p>
<h2 id="set-up-em-for-rtir">Set up EM for RTIR</h2>
<p>After the data entities are imported into the database, follow these steps to make the EM functionality ready to use.</p>
<ol>
<li>Go to <strong>Tax</strong> &gt; <strong>Setup</strong> &gt; <strong>Electronic messages</strong> &gt; <strong>Executable class settings</strong>, and select the <strong>Message items creation</strong> executable class that is associated with the <strong>EMCreateItemsController_HU</strong> executable class name.</li>
<li>On the Action Pane, select <strong>Parameters</strong>.</li>
<li>In the dialog box, on the <strong>Records to include</strong> FastTab, define values for the parameters of the query.</li>
</ol>
<p><img src="media/3_New_EM_items.png" alt="Add new electronic message items dialog box"></p>
<ol start="4">
<li>Select <strong>OK</strong>.</li>
<li>On the <strong>Executable class settings</strong> page, select the <strong>Additional fields evaluation</strong> executable class that is associated with the <strong>EMAdditionalFieldsEvaluationController_HU</strong> executable class name, select <strong>Parameters</strong> on the Action Pane, and then, in the dialog box, define values for the parameters of the executable class.</li>
</ol>
<p><img src="media/4_Additional_fields.png" alt="Additional fields evaluation parameters dialog box"></p>
<p>The following values must be set for the parameters.</p>
<table>
<thead>
<tr>
<th><strong>Parameter name</strong></th>
<th><strong>Value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Report period start date</td>
<td>The date when you want to start RTIR</td>
</tr>
<tr>
<td>Status for excluded items</td>
<td>Excluded</td>
</tr>
<tr>
<td>Status for items requiring manual editing</td>
<td>Manual editing</td>
</tr>
<tr>
<td>Operation field</td>
<td>Operation</td>
</tr>
<tr>
<td>Original message item field</td>
<td>Original message item</td>
</tr>
<tr>
<td>Last line reference number field</td>
<td>Last line reference number</td>
</tr>
<tr>
<td>Modification index</td>
<td>Modification index</td>
</tr>
</tbody>
</table>
<ol start="6">
<li><p>Select <strong>OK</strong>.</p>
<p>Interoperation with the Hungarian Online invoicing system requires a technical user name and password, and signature and replacement keys. There are two options for storing this sensitive data:</p>
<ul>
<li>Azure Key Vault storage</li>
<li>Local storage</li>
</ul>
</li>
<li><p>Go to <strong>System administration</strong> &gt; <strong>Setup</strong> &gt; <strong>System parameters</strong>, and set the <strong>Use advanced certificate store</strong> option to <strong>No</strong> to store sensitive data locally. Set the option to <strong>Yes</strong> to use Key Vault storage. For more information about how to set up Key Vault, see <a href="https://support.microsoft.com/help/4040305/setting-up-azure-key-vault-client">Setting up Azure Key Vault Client</a> and <a href="https://support.microsoft.com/help/4040294/maintaining-azure-key-vault-storage">Maintaining Azure Key Vault storage</a>.</p>
</li>
<li><p>If you set the <strong>Use advanced certificate store</strong> option to <strong>Yes</strong> on the <strong>System parameters</strong> page, you must set up the Key Vault parameters at <strong>System administration</strong> &gt; <strong>Setup</strong> &gt; <strong>Key Vault parameters</strong>.</p>
</li>
</ol>
<p><img src="media/5_Key_Vault.png" alt="Key Vault parameters page"></p>
<ol start="9">
<li><p>Go to <strong>Tax</strong> &gt; <strong>Setup</strong> &gt; <strong>Parameters</strong> &gt; <strong>Online invoicing system parameters</strong>, and specify the following information:</p>
<ul>
<li>Technical user name</li>
<li>Technical user password</li>
<li>Signature key</li>
<li>Replacement key</li>
</ul>
</li>
<li><p>If you set the <strong>Use advanced certificate store</strong> option to <strong>Yes</strong> on the <strong>System parameters</strong> page, select related secrets on the <strong>General</strong> tab of the <strong>Online invoicing system parameters</strong> page.</p>
</li>
</ol>
<p><img src="media/6_Key_Vault.png" alt="Online invoicing system parameters where Use advance certificate store option is set to yes"></p>
<p>Alternatively, if you set the <strong>Use advanced certificate store</strong> option to <strong>No</strong>, manually enter the technical user name and password, signature key, and replacement key that you obtained for interoperation with the Hungarian Online invoicing system. For more information, see the <a href="https://onlineszamla-test.nav.gov.hu/tajekoztatas_a_regisztraciorol">information about the registration procedure</a>.</p>
<p><img src="media/7_system_parameters.png" alt="Online invoicing system parameters where Use advance certificate store option is set to yes"></p>
<ol start="11">
<li>Go to <strong>Tax</strong> &gt; <strong>Setup</strong> &gt; <strong>Parameters</strong> &gt; <strong>Electronic messages</strong> &gt; <strong>Web service settings</strong>, and enter the following information to define the internet address for web services.</li>
</ol>
<table>
<thead>
<tr>
<th><strong>Web service name</strong></th>
<th><strong>Testing internet address</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Manage invoices</td>
<td><code>https://api-test.onlineszamla.nav.gov.hu/invoiceService/v2/manageInvoice</code></td>
</tr>
<tr>
<td>Query invoice status</td>
<td><code>https://api-test.onlineszamla.nav.gov.hu/invoiceService/v2/queryTransactionStatus</code></td>
</tr>
<tr>
<td>Token exchange</td>
<td><code>https://api-test.onlineszamla.nav.gov.hu/invoiceService/v2/tokenExchange</code></td>
</tr>
</tbody>
</table>
<p>Internet addresses are subject to change by the Hungarian Online invoicing system. Therefore, we recommend that you check for actual internet addresses on the <a href="https://onlineszamla.nav.gov.hu/">official web site of the Hungarian Online invoicing system</a>. The website also has information about the actual <em>production</em> internet addresses that you should set up.</p>
<ol start="12">
<li>Go to <strong>Tax</strong> &gt; <strong>Setup</strong> &gt; <strong>Parameters</strong> &gt; <strong>Electronic messages</strong> &gt; <strong>Message processing actions</strong>, and select <strong>Generate EM</strong>.</li>
<li>In the <strong>Number of message items per export</strong> field, define the number of message items that can be included in one message. This number should not exceed 100.</li>
<li>In the <strong>Items attached compression type</strong> field, specify <strong>None</strong>, and set the <strong>Attach files from output archive to items</strong> option to <strong>Yes</strong>.</li>
</ol>
<p><img src="media/8_actions.png" alt="Message processing actions page, Generate EM tab"></p>
<ol start="15">
<li>Go to <strong>Ta</strong>x &gt; <strong>Setup</strong> &gt; <strong>Electronic messages</strong> &gt; <strong>Electronic message processing</strong>, select <strong>Online invoicing</strong> processing, and then, on the <strong>Batch</strong> FastTab, select <strong>Create batch</strong>.</li>
<li>Set up security roles for <strong>Online invoicing</strong> processing. Different groups of users might require access to <strong>Online invoicing</strong> processing. You can limit access to the processing, based on security groups that are defined in the system. Go to <strong>Tax</strong> &gt; <strong>Setup</strong> &gt; <strong>Electronic messages</strong> &gt; <strong>Electronic message processing</strong>, select <strong>Online invoicing</strong> processing, and add the security groups that must work with this processing. If no security group is defined for the processing, only a system admin can see the processing on the <strong>Electronic messages</strong> page.</li>
</ol>
<h2 id="set-up-financial-reasons-for-rtir">Set up financial reasons for RTIR</h2>
<p>For each invoice that is reported to the Hungarian Online invoicing system, a specific operation type must be defined and transmitted in the <strong>&lt;invoiceOperation&gt;</strong> element in the <strong>ManageInvoiceRequest.xml</strong> file. In most cases, Finance automatically specifies the invoice operation type according to the rules that are defined in requirements of the Hungarian Online invoicing system:</p>
<ul>
<li><strong>Create</strong> – This invoice operation type is specified when Finance defines no reference to original invoice.</li>
<li><strong>Modify</strong> – This invoice operation type is specified when Finance defines a reference to original invoice.</li>
</ul>
<p>You can manually define the operation type for an invoice during invoice posting by using the <strong>Financial reasons</strong> page.</p>
<ul>
<li><p>Go to <strong>Organization administration</strong> &gt; <strong>Setup</strong> &gt; <strong>Financial reasons</strong>. In the <strong>Operation</strong> column, define operation types. The following values are allowed by the Hungarian Online invoicing system:</p>
<ul>
<li><strong>Create</strong> – The invoice in the given position is considered an original invoice.</li>
<li><strong>Modify</strong> – The invoice is a modifying invoice.</li>
<li><strong>Storno</strong> – The invoice is a canceling invoice.</li>
</ul>
</li>
</ul>
<p>By using the related financial reason during invoice posting, you can have a specific operation type reported for an invoice.</p>
<p>For example, you want to submit an invoice of the <strong>Storno</strong> operation type to the Online invoicing system. For this invoice, specify a financial reason that has a value of <strong>Storno</strong> value in <strong>Operation</strong> field. To submit a corrective invoice that has no reference to the original invoice, specify a financial reason that has a value of <strong>Modify</strong> in the <strong>Operation</strong> field.</p>
<h2 id="rtir-process">RTIR process</h2>
<p>Finance automatically runs actions that are included in the processing, based on the status of messages and message items.</p>
<h3 id="additional-fields-for-message-items">Additional fields for message items</h3>
<p>All message items have additional fields that are required for processing. The system automatically fills in values for additional fields when it runs actions.</p>
<table>
<thead>
<tr>
<th><strong>Additional field</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Operation</td>
<td>Values include <strong>Create</strong>, <strong>Modify</strong>, and <strong>Storno</strong>. Finance sets the value of this additional field during execution of the <strong>Evaluate EM items</strong> action. The value of the <strong>Operation</strong> additional field can be defined automatically or through a financial reason on the invoice. For more information, see the <a href="#set-up-financial-reasons-for-rtir">Set up financial reasons for RTIR</a> section earlier in this topic.</td>
</tr>
<tr>
<td>Original invoice item</td>
<td>If the <strong>Operation</strong> additional field is set to <strong>Modify</strong> or <strong>Storno</strong>, the <strong>Original invoice item</strong> additional field must be set. If the system can't set this field, it sets the status of the related message item to <strong>Manual editing</strong>, and you must manually set this field.</td>
</tr>
<tr>
<td>Index</td>
<td>This additional field specifies the invoice position in the request (package of invoices). The value is reported in the <strong>&lt;index&gt;</strong> element in the <strong>ManageInvoiceRequest.xml</strong> file. This additional field is automatically filled in when the <strong>Generate invoice request</strong> action is run.</td>
</tr>
<tr>
<td>Last line reference number</td>
<td>For message items of the <strong>Create</strong> operation type, this additional field contains the last number (invoice line quantity) in the package. For message items of the <strong>Modify</strong> or <strong>Storno</strong> operation type, this additional field contains the <strong>Index</strong> value of the original invoice, as reported in the <strong>&lt;modificationIndex&gt;</strong> element. This additional field is automatically filled in when the <strong>Evaluation</strong> action is run.</td>
</tr>
</tbody>
</table>
<h3 id="run-online-invoicing-processing">Run Online invoicing processing</h3>
<p>This procedure walks you through the RTIR process.</p>
<ol>
<li>Go to <strong>Tax</strong> &gt; <strong>Inquiries and reports</strong> &gt; <strong>Electronic messages</strong> &gt; <strong>Electronic message items</strong>.</li>
<li>On the Action Pane, select <strong>Run processing</strong>.</li>
<li>In the dialog box, in the <strong>Processing</strong> field, select <strong>OnlineInvoicing</strong>.</li>
<li>If you want to run all the possible actions from <strong>Online invoicing</strong> processing, clear the <strong>Choose action</strong> check box. If you want to run only a specific action, select the <strong>Choose action</strong> check box, and then, in the <strong>Action</strong> field, select the action to run.</li>
</ol>
<h3 id="exclude-invoice-reporting-in-rtir">Exclude invoice reporting in RTIR</h3>
<p>To exclude an invoice from processing in RTIR, follow these steps.</p>
<ol>
<li>Go to <strong>Tax</strong> &gt; <strong>Inquiries and reports</strong> &gt; <strong>Electronic messages</strong> &gt; <strong>Electronic message items</strong>.</li>
<li>On the Action Pane, select <strong>Update status</strong> to update the status of the message items to <strong>Excluded</strong>. Invoices that have a status of <strong>Excluded</strong> won't be included in the report.</li>
<li>In the <strong>Update status</strong> dialog box, select <strong>Online invoicing</strong> processing. Then, in the <strong>Action</strong> field, select <strong>Exclude message item</strong>. In the <strong>New status</strong> field, select <strong>Excluded</strong>.</li>
<li>Define additional criteria by using the <strong>Records to include</strong> FastTab to specify which invoices must be excluded from further processing.</li>
</ol>
<h3 id="postpone-invoice-reporting-in-rtir">Postpone invoice reporting in RTIR</h3>
<p>To postpone reporting of an invoice in RTIR, follow these steps.</p>
<ol>
<li>Go to <strong>Tax</strong> &gt; <strong>Inquiries and reports</strong> &gt; <strong>Electronic messages</strong> &gt; <strong>Electronic message items</strong>.</li>
<li>On the Action Pane, select <strong>Update status</strong> to update the status of the message items to <strong>Postponed</strong>. Invoices that have a status of <strong>Postponed</strong> won't be included in the report.</li>
<li>In the <strong>Update status</strong> dialog box, select <strong>Online invoicing</strong> processing. Then, in the <strong>Action</strong> field, select <strong>Update to Postponed</strong> in the <strong>Action</strong> field. In the <strong>New status</strong> field, select <strong>Postponed</strong>.</li>
<li>Define additional criteria by using the <strong>Records to include</strong> FastTab to specify which invoices reporting must be postponed for.</li>
</ol>
<p>You can always reverse the status of <strong>Excluded</strong> or <strong>Postponed</strong> message items by selecting <strong>Update to initial status</strong>.</p>
<h2 id="appendix-1-electronic-message-setup-for-rtir">Appendix 1: Electronic message setup for RTIR</h2>
<p>This appendix provides information about how the EM functionality should be set up so that it supports <strong>Online invoicing</strong> processing. Use this information to determine whether the EM functionality is set up correctly.</p>
<p>Although this appendix includes the most important information about the setup, it doesn't include all the data. We recommend that you use a package of data entities that provides a predefined setup of the functionality, and that includes all the data that is required to set up the processing for RTIR.</p>
<h3 id="web-service-settings">Web service settings</h3>
<p><strong>Online Invoicing</strong> processing uses the following web services.</p>
<table>
<thead>
<tr>
<th><strong>Web service name</strong></th>
<th><strong>Testing Internet address</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Manage invoices</td>
<td><code>https://api-test.onlineszamla.nav.gov.hu/invoiceService/v2/manageInvoice</code></td>
</tr>
<tr>
<td>Query invoice status</td>
<td><code>https://api-test.onlineszamla.nav.gov.hu/invoiceService/v2/queryTransactionStatus</code></td>
</tr>
<tr>
<td>Token exchange</td>
<td><code>https://api-test.onlineszamla.nav.gov.hu/invoiceService/v2/tokenExchange</code></td>
</tr>
</tbody>
</table>
<h3 id="additional-fields">Additional fields</h3>
<p>For a full description of the additional fields for <strong>Online invoicing</strong> processing, see the <a href="#additional-fields-for-message-items">Additional fields for message items</a> section earlier in this topic.</p>
<div class="NOTE">
<h5>Note</h5>
<p>These fields can't be changed by the user.</p>
</div>
<h3 id="electronic-message-item-types">Electronic message item types</h3>
<p>The setup of electronic messages for <strong>Online Invoicing</strong> processing uses one type of electronic message item: <strong>Customer invoice</strong>.</p>
<h3 id="electronic-message-item-statuses">Electronic message item statuses</h3>
<p><strong>Online Invoicing</strong> processing uses the following electronic message item statuses.</p>
<table>
<thead>
<tr>
<th><strong>Status</strong></th>
<th><strong>Description</strong></th>
<th><strong>Records in this status can be deleted</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Accepted</td>
<td>The message item was accepted by the Online invoicing system.</td>
<td>Yes</td>
</tr>
<tr>
<td>Created</td>
<td>The message item was created.</td>
<td>Yes</td>
</tr>
<tr>
<td>Evaluated</td>
<td>The message item's additional fields were evaluated.</td>
<td>Yes</td>
</tr>
<tr>
<td>Excluded</td>
<td>The message item is excluded from processing.</td>
<td>Yes</td>
</tr>
<tr>
<td>In preprocessing</td>
<td>The message item is undergoing preprocessing.</td>
<td>Yes</td>
</tr>
<tr>
<td>Included in invoice request</td>
<td>The message item is included in the manage invoice request.</td>
<td>Yes</td>
</tr>
<tr>
<td>Included in message</td>
<td>The message item is included in the message.</td>
<td>Yes</td>
</tr>
<tr>
<td>Manual editing</td>
<td>The message item requires manual editing.</td>
<td>Yes</td>
</tr>
<tr>
<td>Pending status response</td>
<td>The message item is waiting for a status response.</td>
<td>Yes</td>
</tr>
<tr>
<td>Processed</td>
<td>The message item was processed.</td>
<td>Yes</td>
</tr>
<tr>
<td>Processing</td>
<td>The message item is being processed by the Online invoicing system.</td>
<td>Yes</td>
</tr>
<tr>
<td>Received</td>
<td>The message item was received by the Online invoicing system.</td>
<td>Yes</td>
</tr>
<tr>
<td>Rejected</td>
<td>The message item was rejected by the Online invoicing system.</td>
<td>Yes</td>
</tr>
<tr>
<td>Sent</td>
<td>The message item was sent to the Online invoicing system.</td>
<td>Yes</td>
</tr>
<tr>
<td>Saved</td>
<td>The message item was saved in the Online invoicing system, but processing hasn't yet been completed.</td>
<td>Yes</td>
</tr>
</tbody>
</table>
<h3 id="electronic-message-statuses">Electronic message statuses</h3>
<p><strong>Online Invoicing</strong> processing uses the following electronic message statuses.</p>
<table>
<thead>
<tr>
<th><strong>Status</strong></th>
<th><strong>Description</strong></th>
<th><strong>Records in this status can be deleted</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Error generating invoice request</td>
<td>A technical error occurred when the invoice request was being generated.</td>
<td>No</td>
</tr>
<tr>
<td>Error generating status request</td>
<td>A technical error occurred when the status request was being generated.</td>
<td>No</td>
</tr>
<tr>
<td>Error generating token request</td>
<td>A technical error occurred when the token request was being generated.</td>
<td>No</td>
</tr>
<tr>
<td>Error invoice response importing</td>
<td>A technical error occurred when the invoice response was being imported.</td>
<td>No</td>
</tr>
<tr>
<td>Error response import of status request</td>
<td>A technical error occurred when the response for the status request was being imported.</td>
<td>No</td>
</tr>
<tr>
<td>Error sending invoice request</td>
<td>A technical error occurred when the manage invoice request was being sent.</td>
<td>No</td>
</tr>
<tr>
<td>Error sending status request</td>
<td>A technical error occurred when the invoice status request was being sent.</td>
<td>No</td>
</tr>
<tr>
<td>Error sending token request</td>
<td>A technical error occurred when the token request was being sent.</td>
<td>No</td>
</tr>
<tr>
<td>Error Token response importing</td>
<td>A technical error occurred when the token response was being imported.</td>
<td>No</td>
</tr>
<tr>
<td>Generated</td>
<td>The message was generated.</td>
<td>No</td>
</tr>
<tr>
<td>In process</td>
<td>The message is being processed by the Online invoicing system.</td>
<td>No</td>
</tr>
<tr>
<td>Invoice request generated</td>
<td>The request to submit invoices was generated.</td>
<td>No</td>
</tr>
<tr>
<td>Invoice request submitted</td>
<td>The request that includes invoices was submitted to the Online invoicing system.</td>
<td>No</td>
</tr>
<tr>
<td>Processed</td>
<td>The message was processed by the Online invoicing system.</td>
<td>No</td>
</tr>
<tr>
<td>Sent</td>
<td>The message was sent.</td>
<td>No</td>
</tr>
<tr>
<td>Status request generated</td>
<td>The invoice status request was generated.</td>
<td>No</td>
</tr>
<tr>
<td>Status request submitted</td>
<td>The invoice status request was submitted.</td>
<td>No</td>
</tr>
<tr>
<td>Token received</td>
<td>The token was received.</td>
<td>No</td>
</tr>
<tr>
<td>Token request generated</td>
<td>The token request was generated.</td>
<td>No</td>
</tr>
<tr>
<td>Token request submitted</td>
<td>The token request was submitted.</td>
<td>No</td>
</tr>
<tr>
<td>Transaction ID received</td>
<td>The invoice response that includes the transaction ID was received.</td>
<td>No</td>
</tr>
</tbody>
</table>
<h3 id="electronic-message-actions">Electronic message actions</h3>
<p>For a full description of the electronic message actions of <strong>OnlineInvoicing</strong> processing, see the <a href="#import-a-package-of-data-entities-that-includes-a-predefined-em-setup">Import a package of data entities that includes a predefined EM setup</a> section earlier in this topic.</p>
<h3 id="electronic-processing-actions">Electronic processing actions</h3>
<p><strong>Online Invoicing</strong> processing uses the following electronic processing actions.</p>
<table>
<thead>
<tr>
<th><strong>Name</strong></th>
<th><strong>Run separately</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>Create EM items</td>
<td>No</td>
</tr>
<tr>
<td>Evaluate EM items</td>
<td>No</td>
</tr>
<tr>
<td>Exclude EM items</td>
<td>Yes</td>
</tr>
<tr>
<td>Generate EM</td>
<td>No</td>
</tr>
<tr>
<td>Generate invoice request</td>
<td>No</td>
</tr>
<tr>
<td>Generate status request</td>
<td>No</td>
</tr>
<tr>
<td>Generate token request</td>
<td>No</td>
</tr>
<tr>
<td>Import invoice response</td>
<td>No</td>
</tr>
<tr>
<td>Import status response</td>
<td>No</td>
</tr>
<tr>
<td>Import token response</td>
<td>No</td>
</tr>
<tr>
<td>Include EM items in processing</td>
<td>Yes</td>
</tr>
<tr>
<td>Reset EM item status</td>
<td>Yes</td>
</tr>
<tr>
<td>Reset EM status</td>
<td>Yes</td>
</tr>
<tr>
<td>Submit invoice request</td>
<td>No</td>
</tr>
<tr>
<td>Submit status request</td>
<td>No</td>
</tr>
<tr>
<td>Submit token request</td>
<td>No</td>
</tr>
</tbody>
</table>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/togoAIO/d365Doku/blob/main/articles/finance/localizations/emea-hun-online-invoicing.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
