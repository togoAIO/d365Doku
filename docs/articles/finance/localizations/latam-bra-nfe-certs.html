<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>NF-e certificates | WIKA Documentation </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="NF-e certificates | WIKA Documentation ">
    <meta name="generator" content="docfx 2.56.6.0">
    
    <link rel="shortcut icon" href="../../../microsoft-dynamics-crm-365-icon.ico">
    <link rel="stylesheet" href="../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../../../toc.html">
    <meta property="docfx:tocrel" content="../TOC.html">
    
    <meta property="docfx:rel" content="../../../">
    
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../index.html">
                <img id="logo" class="svg" src="../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="nf-e-certificates">NF-e certificates</h1>


<p>In the Brazilian localization, you must generate a Nota Fiscal eletrônica (NF e) to register the movement of items and services between two parties.
The NF-e fiscal document must be signed and transmitted to the state tax authority using a client certificate issued by a Brazilian certificate authority (CA).
Before you can generate an NF e, you must complete the following tasks:</p>
<ul>
<li><p>Set up web services, rejection codes, and schemas.</p>
</li>
<li><p>For each fiscal establishment, set up:</p>
<ul>
<li>The client certificate</li>
<li>An environment</li>
<li>An NF-e version</li>
<li>An authority</li>
<li>A template</li>
<li>Schema validation</li>
<li>A contingency mode for NF-e</li>
</ul>
</li>
<li><p>Set up automatic printing of the Documento auxiliar da Nota fiscal eletrônica (DANFE), so that the DANFE is automatically printed after NF-e approval.</p>
</li>
<li><p>Set up web services that are related to a fiscal authority.</p>
</li>
<li><p>Set up a fiscal document type for NF-e.</p>
</li>
</ul>
<h2 id="set-up-certificates">Set up certificates</h2>
<p>The process that you use to install certificates varies, depending on the state where the NF e fiscal document is issued. Use the correct certificate installation process so that Dynamics 365 Finance can connect with the state web services.</p>
<p>The Brazilian government updated the root certification authority (CA) that is used to issue the certificate required  to establish a Secure Sockets Layer (SSL) connection on the server side. The current version of the root CA is AC Raiz v5. By default, the previous version (AC Raiz v2) is deployed on Microsoft Windows.</p>
<h2 id="solutions">Solutions</h2>
<ul>
<li>Manually install root CA v5 (AC Raiz v5) – The root certificate must be installed in Trusted Root Certification Authorities store. Although the Brazilian government created a new root certificate (v5), Windows Security hasn’t yet added this certificate to the Trusted Root Certification Authorities store. This means you must open an incident in Windows Support and then manually install the certificate. You can use this workaround until the Windows Security group reaches an agreement with the Brazilian government.</li>
<li>Install the NF-e proxy on an on-premises VM – The tax authorities for the states of Ceará (CE), Goias (GO), and Pernambuco (PE) didn’t enable the most secure and market-standard protocol, Transport Layer Security (TLS) 1.2, in their web servers. However, the Windows virtual machines (VMs) that are used to run Finance follow Microsoft security policy and allow only connections that use TLS 1.2. Therefore, the system can’t connect directly to these web services. To route communications to those three states, customers must install a proxy web service on an on-premises Windows VM in their Microsoft Azure subscription.</li>
</ul>
<p>Brazilian certificates must be installed via Azure Key Vault. Key Vault lets you store encrypt keys, certificates, and secrets (such as authentication keys, storage account keys, data encryption keys, .pxf files, and passwords) by using keys that are protected by hardware security modules (HSMs).</p>
<p>For more information about how to use keys and secrets with Key Vault, see <a href="https://docs.microsoft.com/rest/api/keyvault/about-keys--secrets-and-certificates">About keys, secrets, and certificates</a>.
The following table lists each tax authority and the solution that you should use to install certificates for it.</p>
<table>
<thead>
<tr>
<th>Tax authority</th>
<th>States</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sefaz Amazonas - (AM)</td>
<td>AM</td>
<td>Manually install root CA v5.</td>
</tr>
<tr>
<td>Sefaz Bahia (BA)</td>
<td>BA</td>
<td>Manually install root CA v5.</td>
</tr>
<tr>
<td>Sefaz Ceará (CE)</td>
<td>CE</td>
<td>Install the NF e proxy on an on-premises VM.</td>
</tr>
<tr>
<td>Sefaz Goias (GO)</td>
<td>GO</td>
<td>Install the NF e proxy on an on-premises VM.</td>
</tr>
<tr>
<td>Sefaz Minas Gerais (MG)</td>
<td>MG</td>
<td>Manually install root CA v5.</td>
</tr>
<tr>
<td>Sefaz Mato Grosso do Sul (MS)</td>
<td>MS</td>
<td>No additional solution is required</td>
</tr>
<tr>
<td>Sefaz Mato Grosso (MT)</td>
<td>MT</td>
<td>No additional solution is required</td>
</tr>
<tr>
<td>Sefaz Pernambuco (PE)</td>
<td>PE</td>
<td>Install the NF e proxy on an on-premises VM.</td>
</tr>
<tr>
<td>Sefaz Paraná (PR)</td>
<td>PR</td>
<td>Manually install root CA v5.</td>
</tr>
<tr>
<td>Sefaz Rio Grande do Sul (RS)</td>
<td>RS</td>
<td>No additional solution is required</td>
</tr>
<tr>
<td>Sefaz São Paulo (SP)</td>
<td>SP</td>
<td>No additional solution is required</td>
</tr>
<tr>
<td>Sefaz Virtual Ambiente Nacional (SVAN)</td>
<td>MA, PA</td>
<td>No additional solution is required</td>
</tr>
<tr>
<td>Sefaz Virtual Rio Grande do Sul (SVRS)</td>
<td>AC, AL, AP, DF, ES, PB, PI, RJ, RN, RO, RR, SC, SE, TO</td>
<td>No additional solution is required</td>
</tr>
</tbody>
</table>
<h3 id="contingency-authorization-authorities-used-when-the-authority-is-down-or-offline">Contingency authorization authorities (used when the authority is down or offline)</h3>
<table>
<thead>
<tr>
<th>Tax authority</th>
<th>States</th>
<th>Solution</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sefaz Virtual de Contingência Ambiente Nacional (SVC-AN)</td>
<td>AC, AL, AP, DF, ES, MG, PB, RJ, RN, RO, RR, RS, SC, SE, SP, TO</td>
<td>Manually install root CA v5.</td>
</tr>
<tr>
<td>Sefaz Virtual de Contingência Rio Grande do Sul (SVC-RS)</td>
<td>AM, BA, CE, GO, MA, MS, MT, PA, PE, PI, PR</td>
<td>No additional solution is required</td>
</tr>
</tbody>
</table>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/togoAIO/d365Doku/blob/main/articles/finance/localizations/latam-bra-nfe-certs.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../styles/main.js"></script>
  </body>
</html>
