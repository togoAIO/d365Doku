<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Formula designer in Electronic reporting (ER) | WIKA Documentation </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Formula designer in Electronic reporting (ER) | WIKA Documentation ">
    <meta name="generator" content="docfx 2.56.6.0">
    
    <link rel="shortcut icon" href="../../../../microsoft-dynamics-crm-365-icon.ico">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../../../../toc.html">
    <meta property="docfx:tocrel" content="../../../commerce/TOC.html">
    
    <meta property="docfx:rel" content="../../../../">
    
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../../index.html">
                <img id="logo" class="svg" src="../../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="formula-designer-in-electronic-reporting-er">Formula designer in Electronic reporting (ER)</h1>


<p>This topic explains how to use the formula designer in Electronic reporting (ER). When you design a format for a specific electronic document in ER, you can use formulas to transform data so that it meets the requirements for the document's fulfillment and formatting. These formulas resemble formulas in Microsoft Excel. Various types of functions are supported in the formulas: text, date and time, mathematical, logical, information, and data type conversion functions, and also other, business domain–specific functions.</p>
<h2 id="formula-designer-overview">Formula designer overview</h2>
<p>ER supports the formula designer. Therefore, at design time, you can configure expressions that can be used for the following tasks at runtime:</p>
<ul>
<li>Transform data that is received from an application database and that should be entered in an ER data model that is designed to be a data source for ER formats. (For example, these transformations might include filtering, grouping, and data type conversion.)</li>
<li>Format data that must be sent to a generating electronic document in accordance with the layout and conditions of a specific ER format. (For example, the formatting might be done in accordance with the requested language or culture, or the encoding).</li>
<li>Control the process of creating electronic documents. (For example, the expressions can enable or disable the output of specific elements of the format, depending on processing data. They can also interrupt the document creation process or throw messages to users.)</li>
</ul>
<p>You can open the <strong>Formula designer</strong> page when you perform any of the following actions:</p>
<ul>
<li>Bind data source items to data model components.</li>
<li>Bind data source items to format components.</li>
<li>Complete maintenance of calculated fields that are part of data sources.</li>
<li>Define the visibility conditions for user input parameters.</li>
<li>Design a format's transformations.</li>
<li>Define the enabling conditions for the format's components.</li>
<li>Define the file names for the format's FILE components.</li>
<li>Define the conditions for process control validations.</li>
<li>Define the message text for process control validations.</li>
</ul>
<h2 id="Binding">Data binding</h2>
<p>The ER formula designer can be used to define an expression that transforms data that is received from data sources, so that the data can be entered in the data consumer in the following ways at runtime:</p>
<ul>
<li>From application data sources and runtime parameters to an ER data model</li>
<li>From an ER data model to an ER format</li>
<li>From application data sources and runtime parameters to an ER format</li>
</ul>
<p>The following illustration shows the design of an expression of this type. In this example, the expression rounds the value of the <strong>Intrastat.AmountMST</strong> field in the Intrastat table to two decimal places and then returns the rounded value.</p>
<p><a href="media/picture-expression-binding.jpg"><img src="media/picture-expression-binding.jpg" alt="Data binding expression"></a></p>
<p>The following illustration shows how an expression of this type can be used. In this example, the result of the designed expression is entered in the <strong>Transaction.InvoicedAmount</strong> component of the <strong>Tax reporting model</strong> data model.</p>
<p><a href="media/picture-expression-binding2.jpg"><img src="media/picture-expression-binding2.jpg" alt="Data binding expression being used"></a></p>
<p>At runtime, the designed formula, <code>ROUND (Intrastat.AmountMST, 2)</code>, rounds the value of the <strong>AmountMST</strong> field for each record in the Intrastat table to two decimal places. It then enters the rounded value in the <strong>Transaction.InvoicedAmount</strong> component of the <strong>Tax reporting</strong> data model.</p>
<h2 id="Transformation">Data formatting</h2>
<p>The ER formula designer can be used to define an expression that formats data that is received from data sources, so that the data can be sent as part of the generating electronic document. You might have formatting that must be applied as a typical rule that should be reused for a format. In this case, you can introduce that formatting one time in the format configuration, as a named transformation that has a formatting expression. This named transformation can then be linked to many format components where the output must be formatted according to the formatting expression that you created.</p>
<p>The following illustration shows the design of a transformation of this type. In this example, the <strong>TrimmedString</strong> transformation truncates incoming data of the <em>String</em> data type by removing leading and trailing spaces. It then returns the truncated string value.</p>
<p><a href="media/picture-transformation-design.jpg"><img src="media/picture-transformation-design.jpg" alt="Transformation"></a></p>
<p>The following illustration shows how a transformation of this type can be used. In this example, several format components send text as output to the generating electronic document at runtime. All these format components refer to the <strong>TrimmedString</strong> transformation by name.</p>
<p><a href="media/picture-transformation-usage.jpg"><img src="media/picture-transformation-usage.jpg" alt="Transformation being used"></a></p>
<p>When format components, such as the <strong>partyName</strong> component in the preceding illustration, refer to the <strong>TrimmedString</strong> transformation, the transformation sends text as output to the generating electronic document. This text doesn't include leading and trailing spaces.</p>
<p>If you have formatting that must be applied individually, you can introduce that formatting as an individual expression of a binding of a specific format component. The following illustration shows an expression of this type. In this example, the <strong>partyType</strong> format component is bound to the data source via an expression that converts incoming data from the <strong>Model.Company.RegistrationType</strong> field in the data source to uppercase text. The expression then sends that text as output to the electronic document.</p>
<p><a href="media/picture-binding-with-formula.jpg"><img src="media/picture-binding-with-formula.jpg" alt="Applying formatting to an individual component"></a></p>
<h2 id="Validation">Process flow control</h2>
<p>The ER formula designer can be used to define expressions that control the process flow of generating electronic documents. You can perform the following tasks:</p>
<ul>
<li>Define conditions that determine when a document creation process must be stopped.</li>
<li>Specify expressions that either create messages for the user about stopped processes or throw execution log messages about the continuing process of report generation.</li>
<li>Specify the file names of generating electronic documents, and control the conditions of their creation.</li>
</ul>
<p>Each rule of the process flow control is designed as an individual validation. The following illustration shows a validation of this type. Here is an explanation of the configuration in this example:</p>
<ul>
<li>The validation is evaluated when the <strong>INSTAT</strong> node is created during generation of the XML file.</li>
<li>If the list of transactions is empty, the validation stops the execution process and returns <strong>FALSE</strong>.</li>
<li>The validation returns an error message that includes the text of label SYS70894 in the user's preferred language.</li>
</ul>
<p><a href="media/picture-validation.jpg"><img src="media/picture-validation.jpg" alt="Validation"></a></p>
<p>The ER formula designer can also be used to generate a file name for a generating electronic document and to control the file creation process. The following illustration shows the design of a process flow control of this type. Here is an explanation of the configuration in this example:</p>
<ul>
<li>The list of records from the <strong>model.Intrastat</strong> data source is divided into batches. Each batch contains up to 1,000 records.</li>
<li>The output creates a zip file that contains one file in XML format for every batch that was created.</li>
<li>An expression returns a file name for generating electronic documents by concatenating the file name and the file name extension. For the second batch and all subsequent batches, the file name contains the batch ID as a suffix.</li>
<li>An expression enables (by returning <strong>TRUE</strong>) the file creation process for batches that contain at least one record.</li>
</ul>
<p><a href="media/picture-file-control.jpg"><img src="media/picture-file-control.jpg" alt="Process flow control"></a></p>
<h2 id="Enabled">Document content control</h2>
<p>The ER formula designer can be used to configure expressions that control what data will be put into generated electronic documents at runtime. The expressions can enable or disable the output of specific elements of the format, depending on processing data and configured logic. These expressions can be entered for a single format element in the <strong>Enabled</strong> field on the <strong>Mapping</strong> tab of the <strong>Operations designer</strong> page. You can enter the expressions as a logic condition that returns a <em>Boolean</em> value:</p>
<ul>
<li>If the condition returns <strong>True</strong>, the current format element is run.</li>
<li>If the condition returns <strong>False</strong>, the current format element is skipped.</li>
</ul>
<p>The following illustration shows expressions of this type. (Version 11.12.11 of the <strong>ISO20022 Credit transfer (NO)</strong> format configuration that is provided by Microsoft is used as an example.) The <strong>XMLHeader</strong> format component is configured to describe the structure of the credit transfer message according to the ISO 20022 XML message standards. The <strong>XMLHeader/Document/CstmrCdtTrfInitn/PmtInf/CdtTrfTxInf/RmtInf/Ustrd</strong> format component is configured to add the <strong>Ustrd</strong> XML element to the generated message and to put the remittance information in an unstructured format as text of the following XML elements:</p>
<ul>
<li>The <strong>PaymentNotes</strong> component is used to generate the text of payment notes.</li>
<li>The <strong>DelimitedSequence</strong> component generates comma-separated invoice numbers that are used to settle the current credit transfer.</li>
</ul>
<p><a href="media/GER-FormulaEditor-ControlContent-1.png"><img src="media/GER-FormulaEditor-ControlContent-1.png" alt="PaymentNotes and DelimitedSequence components"></a></p>
<div class="NOTE">
<h5>Note</h5>
<p>The <strong>PaymentNotes</strong> and <strong>DelimitedSequence</strong> components are labeled by using a question mark. A question mark indicates that the use of a component is conditional. In this case, use of the components is based on the following criteria:</p>
<ul>
<li><p>The <code>@.PaymentsNotes &lt;&gt; &quot;&quot;</code> expression that is defined for the <strong>PaymentNotes</strong> component enables (by returning <strong>TRUE</strong>) the <strong>Ustrd</strong> XML element to be filled with the text of payment notes, if that text isn't blank for the current credit transfer.</p>
<p><a href="media/GER-FormulaEditor-ControlContent-2.png"><img src="media/GER-FormulaEditor-ControlContent-2.png" alt="Expression for the PaymentNotes component"></a></p>
</li>
<li><p>The <code>@.PaymentsNotes = &quot;&quot;</code> expression that is defined for the <strong>DelimitedSequence</strong> component enables (by returning <strong>TRUE</strong>) the <strong>Ustrd</strong> XML element to be filled with a comma-separated list of the invoice numbers that are used to settle the current credit transfer, if the text of payment notes for that credit transfer is blank.</p>
<p><a href="media/GER-FormulaEditor-ControlContent-3.png"><img src="media/GER-FormulaEditor-ControlContent-3.png" alt="Expression for the DelimitedSequence component"></a></p>
</li>
</ul>
<p>Based on this setup, the message that is generated for each debtor payment, the <strong>Ustrd</strong> XML element, will contain either the text of payment notes or, when that text is blank, a comma-separated list of the invoice numbers that are used to settle the payment.</p>
</div>
<h2 id="TestFormula">Validation of configured formulas</h2>
<p>On the <strong>Formula designer</strong> page, select <strong>Test</strong> to validate how the configured formula works.</p>
<p><a href="media/ER-FormulaTest-Start.png"><img src="media/ER-FormulaTest-Start.png" alt="Selecting Test to validate a forumula"></a></p>
<p>When the values of formula arguments are required, you can open the <strong>Test expression</strong> dialog box from the <strong>Formula designer</strong> page. In most cases, these arguments must be manually defined, because the configured bindings aren't run at design time. The <strong>Test result</strong> tab on the <strong>Formula designer</strong> page shows the result from execution of the configured formula.</p>
<p>The following example shows how you can test the formula that is configured for the foreign trade domain to make sure that the Intrastat commodity code contains only digits.</p>
<p>When you test this formula, you can use the <strong>Test expression</strong> dialog box to specify the value of the Intrastat commodity code for testing.</p>
<p><a href="media/ER-FormulaTest-Start-EnterArguments.png"><img src="media/ER-FormulaTest-Start-EnterArguments.png" alt="Specifying the Intrastat commodity code for testing"></a></p>
<p>After you specify the Intrastat commodity code and select <strong>OK</strong>, the <strong>Test result</strong> tab on the <strong>Formula designer</strong> page shows the result of execution of the configured formula. You can then evaluate whether the result is acceptable. If the result isn't acceptable, you can update the formula and test it again.</p>
<p><a href="media/ER-FormulaTest-Result.png"><img src="media/ER-FormulaTest-Result.png" alt="Test result"></a></p>
<p>Some formulas can't be tested at design time. For example, a formula might return a result of a data type that can't be shown on the <strong>Test result</strong> tab. In this case, you receive an error message that states that the formula can't be tested.</p>
<p><a href="media/ER-FormulaTest-Error.png"><img src="media/ER-FormulaTest-Error.png" alt="Error message"></a></p>
<h2 id="additional-resources">Additional resources</h2>
<ul>
<li><a href="general-electronic-reporting.html">Electronic Reporting overview</a></li>
<li><a href="er-formula-language.html">Electronic reporting formula language</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/togoAIO/d365Doku/blob/main/articles/fin-ops-core/dev-itpro/analytics/general-electronic-reporting-formula-designer.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
  </body>
</html>
