<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Specify a custom storage location for generated documents | WIKA Documentation </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Specify a custom storage location for generated documents | WIKA Documentation ">
    <meta name="generator" content="docfx 2.56.6.0">
    
    <link rel="shortcut icon" href="../../../../microsoft-dynamics-crm-365-icon.ico">
    <link rel="stylesheet" href="../../../../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../../../../styles/docfx.css">
    <link rel="stylesheet" href="../../../../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../../../../toc.html">
    <meta property="docfx:tocrel" content="../../../commerce/TOC.html">
    
    <meta property="docfx:rel" content="../../../../">
    
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../../../../index.html">
                <img id="logo" class="svg" src="../../../../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="specify-a-custom-storage-location-for-generated-documents">Specify a custom storage location for generated documents</h1>


<p>The application programming interface (API) of the Electronic reporting (ER) framework lets you extend the list of storage locations for documents that ER formats generate. This topic includes an overview of the main tasks that you must complete to add a custom storage location.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>You must deploy a topology that supports continuous build. (For more information, see <a href="https://docs.microsoft.com/dynamics365/unified-operations/dev-itpro/perf-test/continuous-build-test-automation">Deploy topologies that support continuous build and test automation</a>.) You must have access to this topology for one of the following roles:</p>
<ul>
<li>Electronic reporting developer</li>
<li>Electronic reporting functional consultant</li>
<li>System administrator</li>
</ul>
<p>You must also have access to the development environment for this topology.</p>
<h2 id="create-or-import-an-er-format-configuration">Create or import an ER format configuration</h2>
<p>In the current topology, <a href="tasks/er-format-configuration-2016-11.html">create a new ER format</a> to generate documents that you plan to add a custom storage location for. Alternatively, <a href="general-electronic-reporting-manage-configuration-lifecycle.html">import an existing ER format into this topology</a>.</p>
<p><img src="media/er-extend-file-storages-format.png" alt="Format designer page"></p>
<div class="IMPORTANT">
<h5>Important</h5>
<p>The ER format that you create or import must contain at least one of the following format elements:</p>
<ul>
<li>File</li>
<li>Folder</li>
<li>Merger</li>
<li>Attachment</li>
</ul>
</div>
<h2 id="create-a-new-document-type">Create a new document type</h2>
<p>To specify how documents that an ER format generates are routed, you must configure <a href="electronic-reporting-destinations.html">Electronic reporting (ER) destinations</a>. In each ER destination that is configured to store generated documents as files, you must specify a document type of the Document management framework. Different document types can be used to route documents that different ER formats generate.</p>
<ol>
<li>Add a new <a href="https://docs.microsoft.com/dynamics365/fin-ops-core/fin-ops/organization-administration/configure-document-management">document type</a> for the ER format that you created or imported earlier. In the illustration that follows, the document type is <strong>FileX</strong>.</li>
<li>To differentiate this document type from other document types, include a specific keyword in its name. For example, in the illustration that follows, the name is <strong>(LOCAL) folder</strong>.</li>
<li>In the <strong>Class</strong> field, specify <strong>Attach file</strong>.</li>
<li>In the <strong>Group</strong> field, specify <strong>File</strong>.</li>
</ol>
<p><img src="media/er-extend-file-storages-document-type.png" alt="Document types page"></p>
<div class="NOTE">
<h5>Note</h5>
<p>Document types are company-specific. To use an ER format with a configured destination in multiple companies, you must configure a separate document type in each company.</p>
</div>
<h2 id="review-source-code">Review source code</h2>
<p>Review the code of the <strong>insertFile()</strong> method of the <strong>ERDocuManagement</strong> class. Notice that the <strong>AttachingFile()</strong> event is raised while the generated file is attached to a record.</p>
<pre><code class="lang-xpp">/// &lt;summary&gt;
/// Inserts file as attachment in Document Management.
/// &lt;/summary&gt;
/// &lt;param name = &quot;_owner&quot;&gt;A record as the attachment owner.&lt;/param&gt;
/// &lt;param name = &quot;_stream&quot;&gt;The file stream.&lt;/param&gt;
/// &lt;param name = &quot;_filePath&quot;&gt;The file path with name.&lt;/param&gt;
/// &lt;param name = &quot;_attachmentName&quot;&gt;The name of file attachment.&lt;/param&gt;
/// &lt;returns&gt;The reference to inserted file.&lt;/returns&gt;
[Hookable(false)]
public DocuRef insertFile(
    Common _owner, 
    System.IO.Stream _stream, 
    str _filePath, 
    str _attachmentName, 
    DocuTypeId _docuTypeId)
{
    DocuRef docuRef;
    if (_stream)
    {
        DocuType::createDefaults();
        if (!this.isDocuTypeValid(_docuTypeId))
        {
            throw error(strFmt(&quot;@ElectronicReporting:DocuTypeIsNotValid&quot;, _docuTypeId));
        }
        var args = ERDocuManagementAttachingFileEventArgs::construct(_owner, _stream, _filePath, _attachmentName, _docuTypeId);
        ERDocuManagementEvents::onAttachingFile(args);
        if (args.isHandled())
        {
            docuRef = args.getDocuRef();
        }
        else
        {
            docuRef = this.attachFile(_owner, _stream, _filePath, _attachmentName, _docuTypeId);
        }
    }
    return docuRef;
}
</code></pre>
<p>The <strong>AttachingFile()</strong> event is raised when the following ER destinations are processed:</p>
<ul>
<li><strong>Archive</strong> – When this destination is used, a new record for the ER format that is run is created in the ERFormatMappingRunJobTable table. The <strong>Archived</strong> field in this record is set to <strong>False</strong>. If the ER format is successfully run, the generated document is attached to this record, and the <strong>AttachingFile()</strong> event is raised. The document type that is selected in this ER destination determines the storage location for the attached file (Microsoft Azure Storage or a Microsoft SharePoint folder).</li>
<li><strong>Job archive</strong> – When this destination is used, a new record for the ER form that is run is created in the ERFormatMappingRunJobTable table. The <strong>Archived</strong> field in this record is set to <strong>True</strong>. If the ER format is successfully run, the generated document is attached to this record, and the <strong>AttachingFile()</strong> event is raised. The document type that is configured in the ER parameters determines the storage location for the attached file (Azure Storage or a SharePoint folder).</li>
</ul>
<p><img src="media/er-extend-file-storages-parameters.png" alt="Electronic reporting parameters page"></p>
<h2 id="configure-an-er-destination">Configure an ER destination</h2>
<ol>
<li>Configure the archived destination for one of the previously mentioned elements (file, folder, merger, or attachment) of the ER format that you created or imported. For guidance, see <a href="https://docs.microsoft.com/dynamics365/unified-operations/dev-itpro/analytics/tasks/er-destinations-2016-11">ER Configure destinations</a>.</li>
<li>Use the document type that you added earlier for the configured destination. (For the example in this topic, the document type is <strong>FileX</strong>.)</li>
</ol>
<p><img src="media/er-extend-file-storages-destination.png" alt="Destination settings dialog box"></p>
<h2 id="modify-source-code">Modify source code</h2>
<ol>
<li><p>Add a new class to your Microsoft Visual Studio project, and write code to subscribe to the <strong>AttachingFile()</strong> event that was mentioned earlier. (For more information about the extensibility pattern that is used, see <a href="https://docs.microsoft.com/dynamics365/unified-operations/dev-itpro/extensibility/respond-event-handler-result">Respond by using EventHandlerResult</a>.) For example, in the new class, write code that performs the following actions:</p>
<ol>
<li>Store generated files in a folder of the local file system of the server that runs the Application Object Server (AOS) service.</li>
<li>Store these generated files only when the new document type (for example, the <strong>FileX</strong> type that has the &quot;(LOCAL)&quot; keyword in its name) is used while a file is attached to the record in the ER execution job log.</li>
</ol>
<pre><code class="lang-xpp">class ERDocuSubscriptionSample
{
    void new()
    {
    }
    [SubscribesTo(classStr(ERDocuManagementEvents), 
    staticDelegateStr(ERDocuManagementEvents, 
    attachingFile))]
    public static void ERDocuManagementEvents_attachingFile(ERDocuManagementAttachingFileEventArgs _args)
    {
        if (!_args.isHandled())
        {
            DocuType docuType = DocuType::find(_args.getDocuTypeId());
            if (strContains(docuType.Name, '(LOCAL)'))
            {
                _args.markAsHandled();
                var stream = _args.getStream();
                if (stream.CanSeek)
                {
                    stream.Seek(0, System.IO.SeekOrigin::Begin);
                }
                using (var localStream = System.IO.File::OpenWrite(@'c:\0\' + _args.getAttachmentName()))
                {
                    stream.CopyTo(localStream);
                }
            }
        }
    }
}
</code></pre>
</li>
<li><p>Rebuild your project.</p>
</li>
</ol>
<h2 id="run-the-er-format-that-you-created-or-imported">Run the ER format that you created or imported</h2>
<ol>
<li>Execute the ER format that you created or imported.</li>
<li>Go to <strong>Organization administration &gt; Electronic reporting &gt; Electronic reporting jobs</strong>. Find the record that was created for this execution job, and that has the generated file attached to it.</li>
<li>Explore the local <strong>C:\0</strong> folder to find same generated file.</li>
</ol>
<h2 id="additional-resources">Additional resources</h2>
<ul>
<li><a href="electronic-reporting-destinations.html">Electronic reporting (ER) destinations</a></li>
<li><a href="https://docs.wika.com/en-us/dynamics365/supply-chain/fin-ops-core/dev-itpro/extensibility/extensibility-home-page">Extensibility home page (This is an external linThis link was changed due to HTMLfromRepoGenerator)</a></li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/togoAIO/d365Doku/blob/main/articles/fin-ops-core/dev-itpro/analytics/er-custom-storage-generated-documents.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
                <h5>In This Article</h5>
                <div></div>
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../../../../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../../../../styles/docfx.js"></script>
    <script type="text/javascript" src="../../../../styles/main.js"></script>
  </body>
</html>
